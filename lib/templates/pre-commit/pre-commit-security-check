#!/bin/sh

echo "🔒 Running Security Check..."

# Run npm audit
audit_summary=$(npm audit --production --json | jq -r '.metadata.vulnerabilities | "Critical: \(.critical), High: \(.high), Moderate: \(.moderate), Low: \(.low)"')

if [ -z "$audit_summary" ]; then
  echo "❌ npm audit not found! Ensure npm and jq are installed."
  # exit 1
fi

echo "🔍 Security Check Summary: $audit_summary"

# Optionally terminate on critical vulnerabilities
if echo "$audit_summary" | grep -q "Critical: [1-9]"; then
  echo "❌ Critical vulnerabilities detected. Fix them before committing."
  # exit 1
fi

echo "✅ No critical security vulnerabilities found."
